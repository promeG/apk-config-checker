# apk-config-checker

Mark config values in source code, and check it in packaged apk file. 

## Introduction

Assume that we use a boolean constant to control whether app should log some debug info.

```java
	public static final boolean LOG_DEBUG = true;
```

Apparently LOG_DEBUG **should* be false in production release. 

We hope that there is a tool to check the value is correctly set. So this project came out.

```java
	@EnforceBooleanValue(value = false, flavor = "production", buildType = "release")
	public static final boolean LOG_DEBUG = true;
```

Then run the checker: 

```shell
	java -jar checker.jar --androidJar={Path to sdk/platforms/android-{version}/androidjar.jar} --flavor={flavor name to check} --buildType={build type to check}  path/to/App.apk
```

You will get the warning:

```java
	Enforce value fail <<<<<< Filed:  LOG_DEBUG=true  expect: EnforceValueAnnotation{value=false, flavor=production, buildType=release}
``` 

## How to use apk-config-checker

### 1. Add library to your android project
```grovvy
buildscript {
  repositories {
    jcenter()
  }

  dependencies {
    compile 'com.github.promeg:apk-config-checker-lib:1.0.0'
  }
}
```

### 2. Mark config values you want to check

Use Enforce{Boolean, Int, Long, Double, String, Float}Value to mark config values.

Note that BuildConfig.java is generated by android gradle plugin, so you cannot mark fileds in this class. To solve this problem, just create a wrapper class:

```java
final class BuildConfigWrapperForCheck {

	@EnforceBooleanValue(value = false, flavor = "production", buildType = "release")
	private static final boolean LOG_TO_FILE = BuildConfig.LOG_TO_FILE;

    @EnforceBooleanValue(value = true, flavor = "production", buildType = "release")
	private static final boolean REPORT_CRASH = BuildConfig.REPORT_CRASH;

}
```

**IMPORTANT** 
BuildConfig wrapper class should only be used by the checker, do not use it in your code. You can set wrapper class package-private and set the fileds to private.

### 3. Check it!

#### 3.1  build checker.jar 

```shell
$ ./gradlew :checker:assemble  // checker.jar is located in project's root dir
```

### 3.2  run checker

```shell
$ java -jar checker.jar --androidJar={Path to sdk/platforms/android-{version}/androidjar.jar} --flavor={flavor name to check} --buildType={build type to check}  path/to/App.apk
```


## TODO

Craete a gradle plugin to avoid run checker mannully.

## Acknowledgement

The checking function is based on [SOOT](https://github.com/Sable/soot)

Command line interface based on [dex-method-counts](https://github.com/mihaip/dex-method-counts)







